#!/usr/bin/env ruby
require "rubygems"
require "capistrano"
require "capistrano/shell"

module Ext
  def current_task
    super || task_list(true).first
  end
end

cfg = Capistrano::Configuration.new
cfg.set :ssh_options, { :forward_agent => true, :auth_methods => "publickey" }

hosts = ARGV.reject{|a| a.include?("=") }

ARGV.select{|a| a.include?("=") }.each do |flag|
  if flag =~ /--(.*)=(.*)/
    cfg.set $1.to_sym, $2
  end
end

cfg.role :app, *hosts
cfg.task :hello do
end

cfg.extend(Ext)

Capistrano::Shell.run(cfg)

